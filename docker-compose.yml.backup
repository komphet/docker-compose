version: "3.2"
services:

    nginx-proxy:
      image: jwilder/nginx-proxy
      container_name: nginx-proxy
      networks:
        - nat
      ports:
        - "80:80"
        - "443:443"
      volumes:
        - /var/run/docker.sock:/tmp/docker.sock:ro
        - ./certs:/etc/nginx/certs

    xducation-eng-web:
      build:
        context: /mnt/volume-sgp1-02/www/xducation/xducation-eng-web
        dockerfile: /mnt/volume-sgp1-02/www/xducation/xducation-eng-web/Dockerfile
      container_name: xducation-eng-web
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/xducation/xducation-eng-web:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mysql
      ports:
        - 3000
      environment:
        - VIRTUAL_HOST=eng.xducation.lattesoft.co.th
        - NODE_ENV=development

    xducation-admin:
      build:
        context: /mnt/volume-sgp1-02/www/xducation/xducation-admin
        dockerfile: /mnt/volume-sgp1-02/www/xducation/xducation-admin/Dockerfile
      container_name: xducation-admin
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/xducation/xducation-admin:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mysql
      ports:
        - "3032:3000"
      environment:
        - VIRTUAL_HOST=admin.xducation.lattesoft.co.th
        - NODE_ENV=development

    xducation-eng-api:
      build:
        context: /mnt/volume-sgp1-02/www/xducation/xducation-eng-api
        dockerfile: /mnt/volume-sgp1-02/www/xducation/xducation-eng-api/Dockerfile
      container_name: xducation-eng-api
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/xducation/xducation-eng-api:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mysql
      ports:
        - 5000
      environment:
        - VIRTUAL_HOST=api.eng.xducation.lattesoft.co.th
        - NODE_ENV=development

    wisdom-api:
      build:
        context: /mnt/volume-sgp1-02/www/wisdom/wisdom-api
        dockerfile: /mnt/volume-sgp1-02/www/wisdom/wisdom-api/Dockerfile
      container_name: wisdom-api
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/wisdom/wisdom-api:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mysql
      ports:
        - 3030
      environment:
        - VIRTUAL_HOST=api.wisdom.lattesoft.co.th
        - NODE_ENV=development

    wisdom-admin:
      build:
        context: /mnt/volume-sgp1-02/www/wisdom/wisdom-admin-client
        dockerfile: /mnt/volume-sgp1-02/www/wisdom/wisdom-admin-client/Dockerfile
      container_name: wisdom-admin
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/wisdom/wisdom-admin-client:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mysql
      ports:
        - 3031
      environment:
        - VIRTUAL_HOST=admin.wisdom.lattesoft.co.th
        - NODE_ENV=development

    sun-exp-backend:
      build:
        context: /mnt/volume-sgp1-02/www/sunexp/sun-exp-backend
        dockerfile: /mnt/volume-sgp1-02/www/sunexp/sun-exp-backend/Dockerfile
      container_name: sun-exp-backend
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/sunexp/sun-exp-backend:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mysql
      ports:
        - "3033:3030"
      environment:
        - VIRTUAL_HOST=api.sunexp.lattesoft.co.th
        - NODE_ENV=development

    sun-expo-client:
      build:
        context: /mnt/volume-sgp1-02/www/sunexp/sun-expo-client
        dockerfile: /mnt/volume-sgp1-02/www/sunexp/sun-expo-client/Dockerfile
      container_name: sun-expo-client
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/sunexp/sun-expo-client:/usr/src/app
        - /usr/src/app/node_modules
      ports:
        - 3001
      environment:
        - VIRTUAL_HOST=sunexp.lattesoft.co.th
        - NODE_ENV=development

    utnai-backend:
      build:
        context: /mnt/volume-sgp1-02/www/utnai/utnai-backend
        dockerfile: /mnt/volume-sgp1-02/www/utnai/utnai-backend/Dockerfile
      container_name: utnai-backend
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/utnai/utnai-backend:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mysql
      ports:
        - "3034:3030"
      environment:
        - VIRTUAL_HOST=api.utnai.lattesoft.co.th
        - NODE_ENV=development

    se-kmitl:
      image: cezerin/cezerin
      container_name: se-kmitl
      restart: always
      networks:
        - nat
      links:
        - mongo
      environment:
        - VIRTUAL_HOST=se.kmitl.lattesoft.co.th
        - DB_HOST=mongo
        - DB_PORT=27017
        - DB_NAME=shop
        - DB_USER=
        - DB_PASS=


    mysql:
      build: ./build/mysql
      container_name: mysql
      user: "1000:50"
      networks:
        - nat
      command: 
        --sql-mode="STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"
      volumes:
        - "./build/mysql:/docker-entrypoint-initdb.d"
        - "./tmp/mysql:/var/lib/mysql"
      environment:
        MYSQL_DATABASE: "xducation"
        MYSQL_USER: "xducation"
        MYSQL_PASSWORD: "xducation"
        MYSQL_ROOT_PASSWORD: "lattesoftunicorn"
      ports:
        - "3306:3306"

    myadmin:
      build: ./build/myadmin
      networks:
        - nat
      container_name: myadmin
      links:
        - mysql:db
      environment:
        - VIRTUAL_HOST=myadmin.lattesoft.co.th

    mongo:
      image: mongo:latest
      networks:
        - nat
      container_name: mongo
      environment:
        - VIRTUAL_HOST=mongo.lattesoft.co.th
      volumes:
        - "./tmp/mongo:/data/db"
      ports:
        - "27017:27017"
    mongo-admin:
      build:
        context: /mnt/volume-sgp1-02/www/komphet/adminMongo
        dockerfile: /mnt/volume-sgp1-02/www/komphet/adminMongo/Dockerfile
      container_name: mongo-admin
      restart: always
      networks:
        - nat
      volumes:
        - /mnt/volume-sgp1-02/www/komphet/adminMongo:/usr/src/app
        - /usr/src/app/node_modules
      links:
        - mongo
      ports:
        - 1234
      environment:
        - VIRTUAL_HOST=admin.mongo.lattesoft.co.th


networks:
  nat:
